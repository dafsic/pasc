#PASC(private and security communication base ipv6)
## 不敢高声语，恐惊天上人。

------

###预计使用方法
> * pasc -c  ipv6地址   与具有此ipv6地址的人开始一个会话
> * pasc -l  [name] 用户登陆,即开始监听12341端口
> * pasc -q  name      返回名字为name的用户的ipv6地址
> * pasc -j  name 用户注册
> * pasc -f  name 刷新ipv6地址

### 设计缘由
人们平时通过通信软件与不在身边的朋友或者合作伙伴交流的时候，尤其是私密或者重要的谈话，一定希望他们的谈话内容是安全的。这是一个正当且合理的要求，因为每个公民都有言论自由和隐私权，任何人都不应该被非法监控。所谓的安全需要两方面保证，一是要保证他们的谈话内容只在他们之间传输，而不是在去某地的服务器或第三者绕一圈。我们不信任第三者，也不希望谈话数据保存在我们不能绝对控制的地方。二是要保证即使被有心人截获之后也无法得知他们的通话内容。第一方面的保证需要的是一个点对点的通信程序，第二方面需要的就是要对谈话内容进行加密。又由于ipv4地址的枯竭，和ipv4对网络端到端的特性的破坏，ipv6迟早要取ipv4而代之。

------
### 设计理念
此程序为P2P模型，摒弃了以服务器为中心的C/S模型，让网络上所有主机重新回归到对等的地位。P2P模型使得每台机器在消耗服务的同时也给别人提供服务。但是这种模型存在一个显著的问题，即主机之间很难互相发现。所以一般需要一个发现服务器。又考虑的用户的自由，用户可以向服务器注册也可以不注册，给予用户自由选择的权利。注册会让别人更方便的找到，不注册则更好的保护自己。如果用户知道对方ipv6的地址可以直接以 `pass –c ipv6地址` 的方式与对方开启一个通话（如果对方同意的话）。如果用户向服务器注册则是把一个名字与一个ipv6的地址绑定。在不知道对方ipv6地址的情况下，如果对方有注册，那么就可以通过 `pass –q name`  的形式查询到对方的ipv6地址。当然注册和刷新是要提供密码的。用户一旦开启一个通话，他们的通话数据只在彼此之间传输，不经过任何第三者，且通话内容将被加密传输。`pasc -l [name]`这里的name是可选的，它用来开启服务，即监听某个端口，以便接受对方的连接。这里没有设置管理好友的功能也是经过慎重思考之后的决定。因为此软件的定位就不是为了普通的闲话聊天，这样，我们假设如果别人得到了你的密码，他也无法得知你的好友或者合作伙伴。也是因为此，我们把通话记录的功能也去掉了，这样既保证了一定的安全，又使软件变得简单，保证用户不用花费时间去学习命令行的使用。如果是闲聊的话应该考虑其他有更加友好界面的软件。
至于服务端，有一个数据库，简单的只有一张表，它只保存注册用户的name ，ipv6地址，id号，可能还有是否在线的状态信息。

------
###加密方式的选择
考虑加密方式有对称加密和非对称加密，如果只用非对称加密算法加密，即把公钥公开出去，传输数据时用对方的公钥对数进行加密，对方收到后用自己的私钥解密。但是有两个问题，一是非对称加密算法比较复杂，对少量数据加密尚可，对大量数据加密效率就太低了，也因此非对称加密通常用来传输对称加密的密钥，用对称加密算法对数据进行加密。二是这种方法公钥也可能被人非法替换，导致中间人攻击，所以每个人都要到CA去认证，这个相比起来就显得麻烦，而且很不必要。况且认证中心也未必可靠。
这里以暗号口令的方式进行认证，用对称加密算法加密。暗号分上下两句，暗号的传递是通过其他方式进行的，比如电话，短信，邮件等。认证过程是这样的：发送方用明文发送暗号的上句，接受方收到后输入暗号的下句，但不发送任何消息给发送方，这只是我们不发送，tcp协议在接受到数据后自然会发送ack报文，这个我们不管。发送方用暗号下句加密一个随机数发送出去，接受方接受之后，用暗号下句进行解密，把随机数加一，加密发送给对方。发送方收到加一的数后，验证是否正确，如果正确，再加一发送，并开始通话，不符合则断开连接。接受方接收到这个加二的数据后，也进行验证，验证通过则开启通话，失败则关闭连接。
这样的验证方式是类似tcp的三次握手。

------
### 数据库结构
 id       | name   |  addr  | online  | lastlogin
:--------   | :-----  | :----  |:-----|:----
1    | dafsic |fe80::76d4:35ff:fe83:a300 |yes|2015-03-02
2 |alkaid|fe80::fc54:ff:fe67:629e |no|2015-01-21

------
###相关知识
> * 本地链路地址只用于本地链路范围,不能在站点内的子网间路由（fe80::)
> * 站点本地地址类似与ipv4的内网的概念(fec0::)
> * 当指定AF_INET6时，如果用链路本地地址，在connect时会出现Invalid argument错误
> * 站点本地地址则可以
> * 关闭两端的防火墙进行测试
> * ifconfig eth0:1 inet6 add fec0::3/64添加站点本地地址
> * ping6 -I eth0 fec0::3  检测主机是否可达
> * netstat -ant 查看tcp端口
> * tcpdump -nt -X -i eth0 'src fec0::3 || dst fec0::3'抓包

